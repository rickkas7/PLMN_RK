<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PLMN_RK: PLMN_RK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PLMN_RK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="class_p_l_m_n___r_k.html">PLMN_RK</a> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a> <em>Utility functions for manipulating cellular PLMNs on Particle cellular devices</em></p>
<ul>
<li>Github Repository: <a href="https://github.com/rickkas7/PLMN_RK">https://github.com/rickkas7/PLMN_RK</a></li>
<li>License: MIT</li>
<li>Full browsable API documentation available <a href="https://rickkas7.github.io/PLMN_RK/index.html">here</a> as well as in the docs directory</li>
</ul>
<p>These helper functions are used to convert between MCC-MNC (Mobile Country Code - Mobile Network Code) and PLMN format. There are also functions for manipulating the FPLMN (Forbidden Public Land Mobile Network) list in the SIM.</p>
<p><b>FPLMN functions are not working in this version of the code</b>. They appear to be accepted by the cellular modem, but the change never takes effect and do not appear to be saved on the SIM. I do not know why this is, and it makes this code essentially useless, but I published it in case any one knows the reason why.</p>
<p>Because it does not work, it is not released as a Particle community library, though you could manually include it in your project as a <a href="https://docs.particle.io/getting-started/device-os/firmware-libraries/#workbench-pseudo-libraries">Workbench pseudo-library</a>.</p>
<h1>FPLMN</h1>
<p>The FPLMN (Forbidden Public Land Mobile Network) list is stored in the SIM and lists up to 4 PLMN to not connect to. Often, this list will be empty. It is also possible if your SIM or Device is banned from a network it will be added automatically to the FPLMN so no more attempts will be made to connect to that network.</p>
<p>In theory, you can also add a specific carrier MCC-MNC to the list yourself. This would prevent connecting to that network. This is not recommended. If the remaining networks are unavailable, it will never fall back to a network in the FPLMN. Also, on some SIMs, forcing a connection via a backup carrier could cause your SIM to be banned.</p>
<p><b>In general you should never modify the FPLMN!</b></p>
<h1>Usage</h1>
<p>See example 1-simple:</p>
<p>Of note:</p>
<ul>
<li>Make sure you use <code>SYSTEM_MODE(SEMI_AUTOMATIC)</code> as you must update the FPLMN before connecting to cellular. You should also enable the system thread.</li>
</ul>
<div class="fragment"><div class="line">SYSTEM_MODE(SEMI_AUTOMATIC);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// System thread defaults to on in 6.2.0 and later and this line is not required</span></div>
<div class="line"><span class="preprocessor">#ifndef SYSTEM_VERSION_v620</span></div>
<div class="line">SYSTEM_THREAD(ENABLED);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p>The code generally looks like this. In this example, AT&amp;T in the United States is added the the FPLMN, which is not recommended.</p>
<div class="fragment"><div class="line">Cellular.on();</div>
<div class="line">waitFor(Cellular.isOn, 10000);</div>
<div class="line"> </div>
<div class="line">Log.info(<span class="stringliteral">&quot;cellular on&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="class_p_l_m_n___r_k.html#aef5a53484ec6a9e3069d3a183072c111">PLMN_RK::instance</a>().<a class="code hl_function" href="class_p_l_m_n___r_k.html#a2bfab9d14d4813eb75cc302cd5d266d4">updateIfNecessary</a>([](<a class="code hl_class" href="class_p_l_m_n___r_k_1_1_p_l_m_n_list.html">PLMN_RK::PLMNList</a> &amp;list) {</div>
<div class="line">    list.<a class="code hl_function" href="class_p_l_m_n___r_k_1_1_p_l_m_n_list.html#a7768ea11ccd548d3b9f9f4ee1a1e1365">add_US_TMobile</a>();</div>
<div class="line">});</div>
<div class="ttc" id="aclass_p_l_m_n___r_k_1_1_p_l_m_n_list_html"><div class="ttname"><a href="class_p_l_m_n___r_k_1_1_p_l_m_n_list.html">PLMN_RK::PLMNList</a></div><div class="ttdoc">Class to hold a list of up to 4 PLMN values.</div><div class="ttdef"><b>Definition</b> PLMN_RK.h:184</div></div>
<div class="ttc" id="aclass_p_l_m_n___r_k_1_1_p_l_m_n_list_html_a7768ea11ccd548d3b9f9f4ee1a1e1365"><div class="ttname"><a href="class_p_l_m_n___r_k_1_1_p_l_m_n_list.html#a7768ea11ccd548d3b9f9f4ee1a1e1365">PLMN_RK::PLMNList::add_US_TMobile</a></div><div class="ttdeci">void add_US_TMobile()</div><div class="ttdoc">Add United States AT&amp;T to the list if it does not already exist.</div><div class="ttdef"><b>Definition</b> PLMN_RK.h:329</div></div>
<div class="ttc" id="aclass_p_l_m_n___r_k_html_a2bfab9d14d4813eb75cc302cd5d266d4"><div class="ttname"><a href="class_p_l_m_n___r_k.html#a2bfab9d14d4813eb75cc302cd5d266d4">PLMN_RK::updateIfNecessary</a></div><div class="ttdeci">void updateIfNecessary(std::function&lt; void(PLMNList &amp;list)&gt; updaterFn)</div><div class="ttdoc">Utility function to get the FPLMN and update it only if necessary.</div><div class="ttdef"><b>Definition</b> PLMN_RK.cpp:22</div></div>
<div class="ttc" id="aclass_p_l_m_n___r_k_html_aef5a53484ec6a9e3069d3a183072c111"><div class="ttname"><a href="class_p_l_m_n___r_k.html#aef5a53484ec6a9e3069d3a183072c111">PLMN_RK::instance</a></div><div class="ttdeci">static PLMN_RK &amp; instance()</div><div class="ttdoc">Gets the singleton instance of this class, allocating it if necessary.</div><div class="ttdef"><b>Definition</b> PLMN_RK.cpp:8</div></div>
</div><!-- fragment --><p>This will add the specified carrier to the list if it is not already in the list, and there's room. Note that if an update occurs, it will take some time because it needs to be written, then the modem powered off and powered back on again.</p>
<p>There are other add* functions in the library for other US carriers, but in general you will use this form to add a single network:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="class_p_l_m_n___r_k.html#aef5a53484ec6a9e3069d3a183072c111">PLMN_RK::instance</a>().<a class="code hl_function" href="class_p_l_m_n___r_k.html#a2bfab9d14d4813eb75cc302cd5d266d4">updateIfNecessary</a>([](<a class="code hl_class" href="class_p_l_m_n___r_k_1_1_p_l_m_n_list.html">PLMN_RK::PLMNList</a> &amp;list) {</div>
<div class="line">    list.<a class="code hl_function" href="class_p_l_m_n___r_k_1_1_p_l_m_n_list.html#a642b72e5481d3818ec3dc97ee34f7eb4">add</a>(<span class="stringliteral">&quot;310410&quot;</span>);</div>
<div class="line">});</div>
<div class="ttc" id="aclass_p_l_m_n___r_k_1_1_p_l_m_n_list_html_a642b72e5481d3818ec3dc97ee34f7eb4"><div class="ttname"><a href="class_p_l_m_n___r_k_1_1_p_l_m_n_list.html#a642b72e5481d3818ec3dc97ee34f7eb4">PLMN_RK::PLMNList::add</a></div><div class="ttdeci">bool add(MccMnc value)</div><div class="ttdoc">Add an MCC-MNC to the list if it does not exist and there is space.</div><div class="ttdef"><b>Definition</b> PLMN_RK.cpp:272</div></div>
</div><!-- fragment --><p>You can add multiple networks with multiple calls to add, though there is a limit of 4.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="class_p_l_m_n___r_k.html#aef5a53484ec6a9e3069d3a183072c111">PLMN_RK::instance</a>().<a class="code hl_function" href="class_p_l_m_n___r_k.html#a2bfab9d14d4813eb75cc302cd5d266d4">updateIfNecessary</a>([](<a class="code hl_class" href="class_p_l_m_n___r_k_1_1_p_l_m_n_list.html">PLMN_RK::PLMNList</a> &amp;list) {</div>
<div class="line">    list.<a class="code hl_function" href="class_p_l_m_n___r_k_1_1_p_l_m_n_list.html#a642b72e5481d3818ec3dc97ee34f7eb4">add</a>(<span class="stringliteral">&quot;311580&quot;</span>); </div>
<div class="line">    list.<a class="code hl_function" href="class_p_l_m_n___r_k_1_1_p_l_m_n_list.html#a642b72e5481d3818ec3dc97ee34f7eb4">add</a>(<span class="stringliteral">&quot;311588&quot;</span>);</div>
<div class="line">});</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
